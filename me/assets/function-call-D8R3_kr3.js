import{aj as he,ae as K,ab as V,x as se,p as J,d as Q,r as O,R as we,W as B,X as U,M as ye,s as X,N as re,aa as Ie,k as ce,E as G,b as m,B as $,C as z,D as N,Z as Se,ak as Ce,H as A,I as ue,G as Pe,al as be,am as xe,a9 as H,a3 as q,an as E,ao as ke,L as ze,ap as me,a6 as Oe,J as Te,P as Re,ac as Ee,A as _,K as ne,a0 as Xe,a4 as Ye,aq as Ze,ar as Le}from"./index-CLivS-D9.js";import{S as $e,a as De}from"./index-HPe5ua-z.js";function Be(){const e=K({show:!1}),s=c=>{e.show=c},u=c=>{se(e,c,{transitionAppear:!0}),s(!0)},o=()=>s(!1);return V({open:u,close:o,toggle:s}),{open:u,close:o,state:e,toggle:s}}function Me(e){const s=he(e),u=document.createElement("div");return document.body.appendChild(u),{instance:s.mount(u),unmount(){s.unmount(),document.body.removeChild(u)}}}const[He,Z]=J("image"),_e={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:$,height:$,radius:$,lazyLoad:Boolean,iconSize:$,showError:z,errorIcon:N("photo-fail"),iconPrefix:String,showLoading:z,loadingIcon:N("photo"),crossorigin:String,referrerpolicy:String};var We=Q({name:He,props:_e,emits:["load","error"],setup(e,{emit:s,slots:u}){const o=O(!1),c=O(!0),l=O(),{$Lazyload:d}=we().proxy,T=B(()=>{const t={width:U(e.width),height:U(e.height)};return ye(e.radius)&&(t.overflow="hidden",t.borderRadius=U(e.radius)),t});X(()=>e.src,()=>{o.value=!1,c.value=!0});const g=t=>{c.value&&(c.value=!1,s("load",t))},P=()=>{const t=new Event("load");Object.defineProperty(t,"target",{value:l.value,enumerable:!0}),g(t)},b=t=>{o.value=!0,c.value=!1,s("error",t)},f=(t,w,C)=>C?C():m(ue,{name:t,size:e.iconSize,class:w,classPrefix:e.iconPrefix},null),h=()=>{if(c.value&&e.showLoading)return m("div",{class:Z("loading")},[f(e.loadingIcon,Z("loading-icon"),u.loading)]);if(o.value&&e.showError)return m("div",{class:Z("error")},[f(e.errorIcon,Z("error-icon"),u.error)])},R=()=>{if(o.value||!e.src)return;const t={alt:e.alt,class:Z("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?Se(m("img",A({ref:l},t),null),[[Ce("lazy"),e.src]]):m("img",A({ref:l,src:e.src,onLoad:g,onError:b},t),null)},S=({el:t})=>{const w=()=>{t===l.value&&c.value&&P()};l.value?w():G(w)},Y=({el:t})=>{t===l.value&&!o.value&&b()};return d&&re&&(d.$on("loaded",S),d.$on("error",Y),Ie(()=>{d.$off("loaded",S),d.$off("error",Y)})),ce(()=>{G(()=>{var t;(t=l.value)!=null&&t.complete&&!e.lazyLoad&&P()})}),()=>{var t;return m("div",{class:Z({round:e.round,block:e.block}),style:T.value},[R(),h(),(t=u.default)==null?void 0:t.call(u)])}}});const Ne=Pe(We),ie=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Ae=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),F=J("image-preview")[1],le=2.6,je={src:String,show:Boolean,active:Number,minZoom:H($),maxZoom:H($),rootWidth:H(Number),rootHeight:H(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var Ue=Q({props:je,emits:["scale","close","longPress"],setup(e,{emit:s,slots:u}){const o=K({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),c=be(),l=O(),d=O(),T=O(!1),g=O(!1);let P=0;const b=B(()=>{const{scale:a,moveX:n,moveY:i,moving:v,zooming:I,initializing:k}=o,M={transitionDuration:I||v||k?"0s":".3s"};return(a!==1||g.value)&&(M.transform=`matrix(${a}, 0, 0, ${a}, ${n}, ${i})`),M}),f=B(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:n}=e,i=T.value?n/o.imageRatio:a;return Math.max(0,(o.scale*i-a)/2)}return 0}),h=B(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:n}=e,i=T.value?n:a*o.imageRatio;return Math.max(0,(o.scale*i-n)/2)}return 0}),R=(a,n)=>{var i;if(a=E(a,+e.minZoom,+e.maxZoom+1),a!==o.scale){const v=a/o.scale;if(o.scale=a,n){const I=me((i=l.value)==null?void 0:i.$el),k={x:I.width*.5,y:I.height*.5},M=o.moveX-(n.x-I.left-k.x)*(v-1),fe=o.moveY-(n.y-I.top-k.y)*(v-1);o.moveX=E(M,-f.value,f.value),o.moveY=E(fe,-h.value,h.value)}else o.moveX=0,o.moveY=g.value?P:0;s("scale",{scale:a,index:e.active})}},S=()=>{R(1)},Y=()=>{const a=o.scale>1?1:2;R(a,a===2||g.value?{x:c.startX.value,y:c.startY.value}:void 0)};let t,w,C,r,x,y,D,p,j=!1;const ve=a=>{const{touches:n}=a;if(t=n.length,t===2&&e.disableZoom)return;const{offsetX:i}=c;c.start(a),w=o.moveX,C=o.moveY,p=Date.now(),j=!1,o.moving=t===1&&(o.scale!==1||g.value),o.zooming=t===2&&!i.value,o.zooming&&(r=o.scale,x=ie(n))},de=a=>{const{touches:n}=a;if(c.move(a),o.moving){const{deltaX:i,deltaY:v}=c,I=i.value+w,k=v.value+C;if((e.vertical?c.isVertical()&&Math.abs(k)>h.value:c.isHorizontal()&&Math.abs(I)>f.value)&&!j){o.moving=!1;return}j=!0,q(a,!0),o.moveX=E(I,-f.value,f.value),o.moveY=E(k,-h.value,h.value)}if(o.zooming&&(q(a,!0),n.length===2)){const i=ie(n),v=r*i/x;y=Ae(n),R(v,y)}},ee=a=>{var n;const i=(n=d.value)==null?void 0:n.$el;if(!i)return;const v=i.firstElementChild,I=a.target===i,k=v==null?void 0:v.contains(a.target);!e.closeOnClickImage&&k||!e.closeOnClickOverlay&&I||s("close")},ge=a=>{if(t>1)return;const n=Date.now()-p,i=250;c.isTap.value&&(n<i?e.doubleScale?D?(clearTimeout(D),D=null,Y()):D=setTimeout(()=>{ee(a),D=null},i):ee(a):n>Oe&&s("longPress"))},oe=a=>{let n=!1;if((o.moving||o.zooming)&&(n=!0,o.moving&&w===o.moveX&&C===o.moveY&&(n=!1),!a.touches.length)){o.zooming&&(o.moveX=E(o.moveX,-f.value,f.value),o.moveY=E(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,w=0,C=0,r=1,o.scale<1&&S();const i=+e.maxZoom;o.scale>i&&R(i,y)}q(a,n),ge(a),c.reset()},ae=()=>{const{rootWidth:a,rootHeight:n}=e,i=n/a,{imageRatio:v}=o;T.value=o.imageRatio>i&&v<le,g.value=o.imageRatio>i&&v>=le,g.value&&(P=(v*a-n)/2,o.moveY=P,o.initializing=!0,ke(()=>{o.initializing=!1})),S()},te=a=>{const{naturalWidth:n,naturalHeight:i}=a.target;o.imageRatio=i/n,ae()};return X(()=>e.active,S),X(()=>e.show,a=>{a||S()}),X(()=>[e.rootWidth,e.rootHeight],ae),xe("touchmove",de,{target:B(()=>{var a;return(a=d.value)==null?void 0:a.$el})}),V({resetScale:S}),()=>{const a={loading:()=>m(ze,{type:"spinner"},null)};return m($e,{ref:d,class:F("swipe-item"),onTouchstartPassive:ve,onTouchend:oe,onTouchcancel:oe},{default:()=>[u.image?m("div",{class:F("image-wrap")},[u.image({src:e.src,onLoad:te,style:b.value})]):m(Ne,{ref:l,src:e.src,fit:"contain",class:F("image",{vertical:T.value}),style:b.value,onLoad:te},a)]})}}});const[qe,L]=J("image-preview"),Fe=["show","teleport","transition","overlayStyle","closeOnPopstate"],Ge={show:Boolean,loop:z,images:Ee(),minZoom:_(1/3),maxZoom:_(3),overlay:z,vertical:Boolean,closeable:Boolean,showIndex:z,className:ne,closeIcon:N("clear"),transition:String,beforeClose:Function,doubleScale:z,overlayClass:ne,overlayStyle:Object,swipeDuration:_(300),startPosition:_(0),showIndicators:Boolean,closeOnPopstate:z,closeOnClickImage:z,closeOnClickOverlay:z,closeIconPosition:N("top-right"),teleport:[String,Object]};var Ke=Q({name:qe,props:Ge,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:s,slots:u}){const o=O(),c=O(),l=K({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),d=()=>{if(o.value){const r=me(o.value.$el);l.rootWidth=r.width,l.rootHeight=r.height,o.value.resize()}},T=r=>s("scale",r),g=r=>s("update:show",r),P=()=>{Ye(e.beforeClose,{args:[l.active],done:()=>g(!1)})},b=r=>{r!==l.active&&(l.active=r,s("change",r))},f=()=>{if(e.showIndex)return m("div",{class:L("index")},[u.index?u.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},h=()=>{if(u.cover)return m("div",{class:L("cover")},[u.cover()])},R=()=>{l.disableZoom=!0},S=()=>{l.disableZoom=!1},Y=()=>m(De,{ref:o,lazyRender:!0,loop:e.loop,class:L("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:b,onDragEnd:S,onDragStart:R},{default:()=>[e.images.map((r,x)=>m(Ue,{ref:y=>{x===l.active&&(c.value=y)},src:r,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:T,onClose:P,onLongPress:()=>s("longPress",{index:x})},{image:u.image}))]}),t=()=>{if(e.closeable)return m(ue,{role:"button",name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),Xe],onClick:P},null)},w=()=>s("closed"),C=(r,x)=>{var y;return(y=o.value)==null?void 0:y.swipeTo(r,x)};return V({resetScale:()=>{var r;(r=c.value)==null||r.resetScale()},swipeTo:C}),ce(d),X([Ze,Le],d),X(()=>e.startPosition,r=>b(+r)),X(()=>e.show,r=>{const{images:x,startPosition:y}=e;r?(b(+y),G(()=>{d(),C(+y,{immediate:!0})})):s("close",{index:l.active,url:x[l.active]})}),()=>m(Re,A({class:[L(),e.className],overlayClass:[L("overlay"),e.overlayClass],onClosed:w,"onUpdate:show":g},Te(e,Fe)),{default:()=>[t(),Y(),f(),h()]})}});let W;const Ve={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function Je(){({instance:W}=Me({setup(){const{state:e,toggle:s}=Be(),u=()=>{e.images=[]};return()=>m(Ke,A(e,{onClosed:u,"onUpdate:show":s}),null)}}))}const eo=(e,s=0)=>{if(re)return W||Je(),e=Array.isArray(e)?{images:e,startPosition:s}:e,W.open(se({},Ve,e)),W};export{Ne as I,Ke as a,Me as m,eo as s,Be as u};
